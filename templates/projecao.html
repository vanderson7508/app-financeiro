{% extends "base.html" %}
{% block title %}Proje√ß√£o de Receitas e Despesas - Financeiro{% endblock %}
{% block content %}

<style>
    .projecao-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
    }

    .projecao-header {
        margin-bottom: 30px;
    }

    .projecao-header h2 {
        color: #333;
        font-size: 2em;
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .projecao-header p {
        color: #666;
        font-size: 1.1em;
    }

    .seletor-mes {
        display: flex;
        gap: 20px;
        align-items: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 25px;
        border-radius: 12px;
        margin-bottom: 30px;
        flex-wrap: wrap;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }

    .seletor-mes label {
        font-weight: 600;
        color: white;
        font-size: 1.05em;
    }

    .seletor-mes select {
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        font-size: 1em;
        cursor: pointer;
        transition: all 0.3s ease;
        background: white;
        color: #333;
        font-weight: 500;
        min-width: 150px;
    }

    .seletor-mes select:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
    }

    .seletor-mes select:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .mes-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }

    .mes-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        font-size: 1.8em;
        font-weight: 600;
        text-align: center;
    }

    .mes-conteudo {
        padding: 40px;
    }

    .secoes-wrapper {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px;
        margin-bottom: 40px;
    }

    .secao {
        padding-bottom: 30px;
    }

    .secao-titulo {
        font-weight: 700;
        color: #333;
        margin-bottom: 20px;
        font-size: 1.3em;
        padding-bottom: 15px;
        border-bottom: 3px solid #e0e0e0;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .secao-titulo.receitas {
        border-bottom-color: #10b981;
        color: #10b981;
    }

    .secao-titulo.despesas {
        border-bottom-color: #ef4444;
        color: #ef4444;
    }

    .item-lista {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        padding: 16px;
        margin-bottom: 12px;
        background: #f9f9f9;
        border-radius: 8px;
        border-left: 4px solid #e0e0e0;
        transition: all 0.3s ease;
    }

    .item-lista:hover {
        background: #f0f0f0;
        transform: translateX(4px);
    }

    .item-lista.receita {
        border-left-color: #10b981;
    }

    .item-lista.despesa {
        border-left-color: #ef4444;
    }

    .item-descricao {
        display: flex;
        flex-direction: column;
        gap: 6px;
        flex: 1;
    }

    .item-nome {
        font-weight: 600;
        color: #333;
        font-size: 1.05em;
    }

    .item-info {
        font-size: 0.9em;
        color: #999;
    }

    .item-valor {
        font-weight: 700;
        font-size: 1.1em;
        text-align: right;
        min-width: 120px;
        padding-left: 20px;
    }

    .item-valor.receita {
        color: #10b981;
    }

    .item-valor.despesa {
        color: #ef4444;
    }

    .sem-items {
        padding: 20px;
        text-align: center;
        color: #999;
        font-style: italic;
        background: #f9f9f9;
        border-radius: 8px;
    }

    .totais-section {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        padding: 30px;
        border-radius: 12px;
        border-top: 3px solid #667eea;
    }

    .total-linha {
        display: flex;
        justify-content: space-between;
        padding: 15px 0;
        font-weight: 600;
        font-size: 1.1em;
        border-bottom: 1px solid #e0e0e0;
    }

    .total-linha:last-child {
        border-bottom: none;
    }

    .total-linha.saldo {
        font-size: 1.3em;
        padding-top: 20px;
        padding-bottom: 0;
        margin-top: 15px;
    }

    .total-receitas {
        color: #10b981;
    }

    .total-despesas {
        color: #ef4444;
    }

    .total-saldo.positivo {
        color: #10b981;
    }

    .total-saldo.negativo {
        color: #ef4444;
    }

    .sem-recorrencias {
        text-align: center;
        padding: 80px 40px;
        background: #f8f9fa;
        border-radius: 12px;
        color: #999;
    }

    .sem-recorrencias-icon {
        font-size: 4em;
        margin-bottom: 20px;
    }

    .sem-recorrencias p {
        font-size: 1.2em;
        margin-bottom: 15px;
    }

    .navegacao {
        margin-top: 30px;
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        justify-content: center;
    }

    .nav-link {
        padding: 12px 25px;
        background: #667eea;
        color: white;
        text-decoration: none;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .nav-link:hover {
        background: #764ba2;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }

    @media (max-width: 768px) {
        .secoes-wrapper {
            grid-template-columns: 1fr;
            gap: 30px;
        }

        .mes-conteudo {
            padding: 20px;
        }

        .seletor-mes {
            flex-direction: column;
            align-items: stretch;
        }

        .seletor-mes select {
            width: 100%;
        }

        .totais-section {
            padding: 20px;
        }
    }
</style>

<div class="projecao-container">
    <!-- HEADER -->
    <div class="projecao-header">
        <h2>üìà Proje√ß√£o de Receitas e Despesas</h2>
        <p>Visualize suas receitas e despesas projetadas para o m√™s selecionado</p>
    </div>

    <!-- SELETOR DE M√äS -->
    <div class="seletor-mes">
        <label for="mes-select">üìÖ Visualizar m√™s:</label>
        <form method="GET" style="display: flex; gap: 10px; align-items: center;">
            <select name="mes" id="mes-select" onchange="this.form.submit()">
                <option value="1" {% if mes_selecionado == 1 %}selected{% endif %}>Janeiro</option>
                <option value="2" {% if mes_selecionado == 2 %}selected{% endif %}>Fevereiro</option>
                <option value="3" {% if mes_selecionado == 3 %}selected{% endif %}>Mar√ßo</option>
                <option value="4" {% if mes_selecionado == 4 %}selected{% endif %}>Abril</option>
                <option value="5" {% if mes_selecionado == 5 %}selected{% endif %}>Maio</option>
                <option value="6" {% if mes_selecionado == 6 %}selected{% endif %}>Junho</option>
                <option value="7" {% if mes_selecionado == 7 %}selected{% endif %}>Julho</option>
                <option value="8" {% if mes_selecionado == 8 %}selected{% endif %}>Agosto</option>
                <option value="9" {% if mes_selecionado == 9 %}selected{% endif %}>Setembro</option>
                <option value="10" {% if mes_selecionado == 10 %}selected{% endif %}>Outubro</option>
                <option value="11" {% if mes_selecionado == 11 %}selected{% endif %}>Novembro</option>
                <option value="12" {% if mes_selecionado == 12 %}selected{% endif %}>Dezembro</option>
            </select>

            <select name="ano" onchange="this.form.submit()">
                {% for y in range(2024, 2030) %}
                    <option value="{{ y }}" {% if ano_selecionado == y %}selected{% endif %}>{{ y }}</option>
                {% endfor %}
            </select>
        </form>
    </div>

    <!-- M√äS SELECIONADO -->
    {% if meses %}
        {% for chave, mes in meses.items() %}
            <div class="mes-container">
                <!-- HEADER DO M√äS -->
                <div class="mes-header">
                    üìÖ {{ mes.mes }} de {{ mes.ano }}
                </div>

                <!-- CONTE√öDO -->
                <div class="mes-conteudo">
                    <!-- RECEITAS E DESPESAS LADO A LADO -->
                    <div class="secoes-wrapper">
                        <!-- RECEITAS -->
                        <div class="secao">
                            <div class="secao-titulo receitas">üíö Receitas</div>
                            {% if mes.receitas %}
                                {% for item in mes.receitas %}
                                    <div class="item-lista receita">
                                        <div class="item-descricao">
                                            <span class="item-nome">{{ item.descricao }}</span>
                                            <span class="item-info">{{ item.categoria }} ‚Ä¢ Dia {{ item.dia_vencimento }}¬∫</span>
                                        </div>
                                        <span class="item-valor receita">+R$ {{ "%.2f"|format(item.valor) }}</span>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <div class="sem-items">Nenhuma receita prevista</div>
                            {% endif %}
                        </div>

                        <!-- DESPESAS -->
                        <div class="secao">
                            <div class="secao-titulo despesas">‚ù§Ô∏è Despesas</div>
                            {% if mes.despesas %}
                                {% for item in mes.despesas %}
                                    <div class="item-lista despesa">
                                        <div class="item-descricao">
                                            <span class="item-nome">{{ item.descricao }}</span>
                                            <span class="item-info">{{ item.categoria }} ‚Ä¢ Dia {{ item.dia_vencimento }}¬∫</span>
                                        </div>
                                        <span class="item-valor despesa">-R$ {{ "%.2f"|format(item.valor) }}</span>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <div class="sem-items">Nenhuma despesa prevista</div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- TOTAIS -->
                    <div class="totais-section">
                        <div class="total-linha">
                            <span>üíö Total Receitas:</span>
                            <span class="total-receitas">+R$ {{ "%.2f"|format(mes.total_receitas) }}</span>
                        </div>
                        <div class="total-linha">
                            <span>‚ù§Ô∏è Total Despesas:</span>
                            <span class="total-despesas">-R$ {{ "%.2f"|format(mes.total_despesas) }}</span>
                        </div>
                        <div class="total-linha saldo {% if mes.saldo >= 0 %}positivo{% else %}negativo{% endif %}">
                            <span>üìä Saldo do M√™s:</span>
                            <span class="total-saldo {% if mes.saldo >= 0 %}positivo{% else %}negativo{% endif %}">
                                {% if mes.saldo >= 0 %}
                                    +R$ {{ "%.2f"|format(mes.saldo) }}
                                {% else %}
                                    -R$ {{ "%.2f"|format(abs(mes.saldo)) }}
                                {% endif %}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="mes-container">
            <div class="sem-recorrencias">
                <div class="sem-recorrencias-icon">üòï</div>
                <p>Nenhuma recorr√™ncia cadastrada para este per√≠odo!</p>
                <p>Crie receitas e despesas recorrentes para ver a proje√ß√£o.</p>
            </div>
        </div>
    {% endif %}

    <!-- NAVEGA√á√ÉO -->
    <div class="navegacao">
        <a href="{{ url_for('home') }}" class="nav-link">‚Üê Voltar para Home</a>
        <a href="{{ url_for('recorrencias') }}" class="nav-link">üîÑ Gerenciar Recorr√™ncias</a>
        <a href="{{ url_for('adicionar') }}" class="nav-link">‚ûï Adicionar Transa√ß√£o</a>
    </div>
</div>

{% endblock %}
