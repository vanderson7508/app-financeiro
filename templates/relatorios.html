<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rios - Financeiro</title>
    <!-- CHART.JS -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        /* SE√á√ÉO DE FILTROS */
        .filtros-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        .filtros-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .filtros-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .form-group input,
        .form-group select {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.95em;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .botoes-filtro {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-filtrar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 1;
            min-width: 150px;
        }

        .btn-filtrar:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-limpar {
            background: #e0e0e0;
            color: #333;
            flex: 1;
            min-width: 150px;
            text-decoration: none;
        }

        .btn-limpar:hover {
            background: #d0d0d0;
        }

        /* RESUMO DE RESULTADOS */
        .resumo-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border-top: 4px solid;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card.receita {
            border-top-color: #10b981;
        }

        .card.despesa {
            border-top-color: #ef4444;
        }

        .card.saldo {
            border-top-color: #667eea;
        }

        .card.quantidade {
            border-top-color: #f59e0b;
        }

        .card h3 {
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            margin-bottom: 10px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .card .valor {
            font-size: 2em;
            font-weight: bold;
        }

        .card.receita .valor {
            color: #10b981;
        }

        .card.despesa .valor {
            color: #ef4444;
        }

        .card.saldo .valor {
            color: #667eea;
        }

        .card.quantidade .valor {
            color: #f59e0b;
        }

        /* SE√á√ÉO DE GR√ÅFICOS */
        .graficos-section {
            margin-bottom: 30px;
        }

        .graficos-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
            border-left: 5px solid #667eea;
            padding-left: 15px;
        }

        .graficos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .grafico-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }

        .grafico-container h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.1em;
            text-align: center;
        }

        .grafico-canvas {
            position: relative;
            height: 350px;
        }

        /* SE√á√ÉO DE TRANSA√á√ïES */
        .transacoes-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            border-left: 5px solid #667eea;
        }

        .transacoes-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .tabela-wrapper {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        table thead {
            background: #f0f0f0;
        }

        table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #e0e0e0;
            font-size: 0.95em;
        }

        table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 0.95em;
        }

        table tbody tr:hover {
            background: #f9f9f9;
        }

        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge.receita {
            background: #d1fae5;
            color: #065f46;
        }

        .badge.despesa {
            background: #fee2e2;
            color: #7f1d1d;
        }

        .valor-positivo {
            color: #10b981;
            font-weight: 600;
        }

        .valor-negativo {
            color: #ef4444;
            font-weight: 600;
        }

        .sem-dados {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .sem-dados p {
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        /* NAVEGA√á√ÉO */
        .nav-voltar {
            margin-bottom: 20px;
        }

        .nav-voltar a {
            display: inline-block;
            padding: 10px 20px;
            background: #e0e0e0;
            color: #333;
            text-decoration: none;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .nav-voltar a:hover {
            background: #667eea;
            color: white;
        }

        /* RESPONSIVO */
        @media (max-width: 1024px) {
            .graficos-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .filtros-grid {
                grid-template-columns: 1fr;
            }

            .botoes-filtro {
                flex-direction: column;
            }

            .resumo-cards {
                grid-template-columns: repeat(2, 1fr);
            }

            table th, table td {
                padding: 10px;
                font-size: 0.85em;
            }

            .grafico-canvas {
                height: 300px;
            }
        }

        @media (max-width: 480px) {
            .resumo-cards {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Relat√≥rios Financeiros</h1>
            <p>Analise suas transa√ß√µes com filtros avan√ßados e visualiza√ß√µes</p>
        </div>

        <div class="content">
            <div class="nav-voltar">
                <a href="{{ url_for('home') }}">‚Üê Voltar para Home</a>
            </div>

            <!-- SE√á√ÉO DE FILTROS -->
            <div class="filtros-section">
                <h2>üîç Filtros</h2>
                <form method="POST" action="{{ url_for('relatorios') }}">
                    <div class="filtros-grid">
                        <div class="form-group">
                            <label for="data_inicio">Data In√≠cio:</label>
                            <input 
                                type="date" 
                                id="data_inicio" 
                                name="data_inicio" 
                                value="{{ data_inicio or '' }}"
                            >
                        </div>

                        <div class="form-group">
                            <label for="data_fim">Data Fim:</label>
                            <input 
                                type="date" 
                                id="data_fim" 
                                name="data_fim" 
                                value="{{ data_fim or '' }}"
                            >
                        </div>

                        <div class="form-group">
                            <label for="categoria">Categoria:</label>
                            <select id="categoria" name="categoria">
                                <option value="">Todas</option>
                                {% for categoria in categorias %}
                                    <option 
                                        value="{{ categoria }}"
                                        {% if categoria_selecionada == categoria %}selected{% endif %}
                                    >
                                        {{ categoria }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="tipo">Tipo:</label>
                            <select id="tipo" name="tipo">
                                <option value="">Todos</option>
                                <option 
                                    value="Receita"
                                    {% if tipo_selecionado == 'Receita' %}selected{% endif %}
                                >
                                    Receita
                                </option>
                                <option 
                                    value="Despesa"
                                    {% if tipo_selecionado == 'Despesa' %}selected{% endif %}
                                >
                                    Despesa
                                </option>
                            </select>
                        </div>
                    </div>

                    <div class="botoes-filtro">
                        <button type="submit" class="btn-filtrar">üîé Filtrar</button>
                        <a href="{{ url_for('relatorios') }}" class="btn-limpar">üóëÔ∏è Limpar Filtros</a>
                    </div>
                </form>
            </div>

            <!-- RESUMO DE RESULTADOS -->
            <div class="resumo-cards">
                <div class="card receita">
                    <h3>üíö Total Receitas</h3>
                    <div class="valor">R$ {{ "%.2f"|format(total_receitas) }}</div>
                </div>

                <div class="card despesa">
                    <h3>‚ù§Ô∏è Total Despesas</h3>
                    <div class="valor">R$ {{ "%.2f"|format(total_despesas) }}</div>
                </div>

                <div class="card saldo">
                    <h3>üíú Saldo</h3>
                    <div class="valor">R$ {{ "%.2f"|format(saldo) }}</div>
                </div>

                <div class="card quantidade">
                    <h3>üìã Quantidade</h3>
                    <div class="valor">{{ quantidade_transacoes }}</div>
                </div>
            </div>

            <!-- SE√á√ÉO DE GR√ÅFICOS -->
            {% if transacoes %}
                <div class="graficos-section">
                    <h2>üìà Visualiza√ß√µes</h2>
                    
                    <div class="graficos-grid">
                        <!-- GR√ÅFICO DE PIZZA -->
                        <div class="grafico-container">
                            <h3>Receitas vs Despesas</h3>
                            <div class="grafico-canvas">
                                <canvas id="chartPizza"></canvas>
                            </div>
                        </div>

                        <!-- GR√ÅFICO DE BARRAS -->
                        <div class="grafico-container">
                            <h3>Totais por Categoria</h3>
                            <div class="grafico-canvas">
                                <canvas id="chartBarras"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- GR√ÅFICO DE LINHA (em tela cheia) -->
                    <div class="grafico-container">
                        <h3>Evolu√ß√£o ao Longo do Tempo</h3>
                        <div class="grafico-canvas" style="height: 400px;">
                            <canvas id="chartLinha"></canvas>
                        </div>
                    </div>
                </div>
            {% endif %}

            <!-- SE√á√ÉO DE TRANSA√á√ïES -->
            <div class="transacoes-section">
                <h2>üìã Transa√ß√µes Filtradas</h2>

                {% if transacoes %}
                    <div class="tabela-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Descri√ß√£o</th>
                                    <th>Categoria</th>
                                    <th>Tipo</th>
                                    <th>Forma de Pagamento</th>
                                    <th>Valor</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for transacao in transacoes %}
                                    <tr>
                                        <td>{{ transacao.data.strftime('%d/%m/%Y') }}</td>
                                        <td>{{ transacao.descricao }}</td>
                                        <td>{{ transacao.categoria }}</td>
                                        <td>
                                            <span class="badge {{ transacao.tipo|lower }}">
                                                {{ transacao.tipo }}
                                            </span>
                                        </td>
                                        <td>{{ transacao.forma_pagamento }}</td>
                                        <td class="{% if transacao.tipo == 'Receita' %}valor-positivo{% else %}valor-negativo{% endif %}">
                                            {% if transacao.tipo == 'Receita' %}
                                                +R$ {{ "%.2f"|format(transacao.valor) }}
                                            {% else %}
                                                -R$ {{ "%.2f"|format(transacao.valor) }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                {% else %}
                    <div class="sem-dados">
                        <p>üòï Nenhuma transa√ß√£o encontrada com os filtros selecionados.</p>
                        <p>Tente ajustar os crit√©rios de filtro.</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var graficoPizza = {
                labels: JSON.parse('{{ grafico_pizza.labels | tojson }}'),
                valores: JSON.parse('{{ grafico_pizza.valores | tojson }}')
            };

            var graficoBarras = {
                labels: JSON.parse('{{ grafico_barras.labels | tojson }}'),
                receitas: JSON.parse('{{ grafico_barras.receitas | tojson }}'),
                despesas: JSON.parse('{{ grafico_barras.despesas | tojson }}')
            };

            var graficoLinha = {
                labels: JSON.parse('{{ grafico_linha.labels | tojson }}'),
                receitas: JSON.parse('{{ grafico_linha.receitas | tojson }}'),
                despesas: JSON.parse('{{ grafico_linha.despesas | tojson }}')
            };

            // GR√ÅFICO DE PIZZA
            var ctxPizza = document.getElementById('chartPizza');
            if (ctxPizza) {
                new Chart(ctxPizza, {
                    type: 'doughnut',
                    data: {
                        labels: graficoPizza.labels,
                        datasets: [{
                            data: graficoPizza.valores,
                            backgroundColor: [
                                'rgba(16, 185, 129, 0.8)',
                                'rgba(239, 68, 68, 0.8)'
                            ],
                            borderColor: [
                                'rgba(16, 185, 129, 1)',
                                'rgba(239, 68, 68, 1)'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    font: { size: 12 }
                                }
                            }
                        }
                    }
                });
            }

            // GR√ÅFICO DE BARRAS
            var ctxBarras = document.getElementById('chartBarras');
            if (ctxBarras) {
                new Chart(ctxBarras, {
                    type: 'bar',
                    data: {
                        labels: graficoBarras.labels,
                        datasets: [
                            {
                                label: 'Receitas',
                                data: graficoBarras.receitas,
                                backgroundColor: 'rgba(16, 185, 129, 0.8)',
                                borderColor: 'rgba(16, 185, 129, 1)',
                                borderWidth: 1
                            },
                            {
                                label: 'Despesas',
                                data: graficoBarras.despesas,
                                backgroundColor: 'rgba(239, 68, 68, 0.8)',
                                borderColor: 'rgba(239, 68, 68, 1)',
                                borderWidth: 1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        indexAxis: 'y',
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    font: { size: 12 }
                                }
                            }
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'R$ ' + value.toFixed(0);
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // GR√ÅFICO DE LINHA
            var ctxLinha = document.getElementById('chartLinha');
            if (ctxLinha) {
                new Chart(ctxLinha, {
                    type: 'line',
                    data: {
                        labels: graficoLinha.labels,
                        datasets: [
                            {
                                label: 'Receitas',
                                data: graficoLinha.receitas,
                                borderColor: 'rgba(16, 185, 129, 1)',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: 'rgba(16, 185, 129, 1)',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            },
                            {
                                label: 'Despesas',
                                data: graficoLinha.despesas,
                                borderColor: 'rgba(239, 68, 68, 1)',
                                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: 'rgba(239, 68, 68, 1)',
                                pointBorderColor: '#fff',
                                pointBorderWidth: 2
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    font: { size: 12 }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return 'R$ ' + value.toFixed(0);
                                    }
                                }
                            }
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
